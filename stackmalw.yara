import "pe"
import "console"
import "math"

rule malwr_strings{
	meta:
		author = "Diyar Saadi"

	strings:
		$a = "pys.jpg"
		$a1 = "happy.txt"
		$b = "WOW64" nocase
		$b1 = " WOW64; _OLE2BIND Trident/4.0; 18A0918C SV1)Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1"
		$c = "%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz"
		$c1 = "&'()*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz"
		$d = "/tmp"
		$d1 = "Microsoft" nocase

	condition:
		(uint16be(0) == 0x4d5a 
		and 2 of ($a*) and 1 of ($b*) and
		2 of ($c*) and 
		1 of ($d*))
}

rule Stack_Strings{
	meta:
		author = "Diyar Saadi"
	
	strings:
		$a = {C6 44 ?? 41 ?? C6 44 ?? 42 ?? C6 ?? 24 ?? 65 C5 
			  44 ?? 44 ?? C6 ?? 25 ?? 73 ?? 5C ??46 ?? 44 24 
			  30 ?? C6 ?? 24 ?? 45 ?? 44 ?? 32 ?? C6 ??24 33
			  56 ?? 44 ?? 34 ?? C6 ?? 24 ?? 43 ?? 44 ??46 65
			  C6 ?? 24 37}
	condition:
		$a and (uint16be(0) == 0x4d5a ) 
}

rule stcks_pe_details{
	meta:
		author = "Diyar Saadi"

	strings:
		$j_a = {C6 44 [2] 41 [2] C6 44 [2] 42 [2] C6 [2] 24 [2] 65 C5}
		$j_a1 = {C6 44 [3] 41 [3] C6 44 [3] 42 [3] C6 [3] 24 [3] 65 C5}
		$j_a2 = {C6 44 [4] 41 [4] C6 44 [4] 42 [4] C6 [4] 24 [4] 65 C5}
		$j_a3 = {C6 44 [5] 41 [5] C6 44 [5] 42 [5] C6 [5] 24 [5] 65 C5}
	condition:
		(uint16be(0) == 0x4d5a
		and pe.number_of_signatures == 0 and pe.number_of_signatures != 0
		and pe.number_of_resources != 0 and pe.number_of_signatures >= 11 and 
		pe.number_of_sections == 4 and pe.number_of_sections != 0 
		and all of ($j_a*)
		)
		
}